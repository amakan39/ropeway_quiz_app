(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const b=document.body,A=document.querySelector("#bg-video"),p=document.querySelector("#startBtn"),a=document.querySelector("#quiz"),d=document.querySelector("#titleBack"),h=document.querySelector("#titleText"),w=document.querySelector("#white-fade");let m=0;const z="./assets/sound/bgm.mp3",q="./assets/img/titleTop.png",v="./assets/img/titleQuiz.png",x="./assets/img/titleEnd.png",k="./assets/img/titleBackWrong.png",E="./assets/img/titleBackEnd.png",T="./assets/img/rogo.png",B="./assets/img/endText.png",g=new Audio(z);class C{constructor(e){this.video=e,this.startTime=0,this.elapsed=0,this.running=!1,this.callbacks=[],this.tickInterval=null}add(e,t){this.callbacks.push({time:e,action:t,executed:!1})}async play(){if(!this.running){this.running=!0;try{await this.video.play()}catch(e){console.warn("Autoplay blocked:",e)}this.startTime=performance.now()-this.elapsed,this.tickInterval=setInterval(()=>this.update(),100)}}pause(){this.running&&(this.running=!1,this.elapsed=performance.now()-this.startTime,clearInterval(this.tickInterval),this.video.pause())}reset(){this.pause(),this.video.currentTime=0,this.elapsed=0,this.startTime=0,this.callbacks.forEach(e=>e.executed=!1)}get time(){return this.running?(performance.now()-this.startTime)/1e3:this.elapsed/1e3}update(){const e=this.time;this.callbacks.forEach(t=>{!t.executed&&e>=t.time&&(t.executed=!0,t.action())})}}const i=new C(A),u=[{questionTextImg:"./assets/img/q1text.png",titleBackImg:"./assets/img/q1titleBack.png",questionNoImg:"./assets/img/q1No.png",a:{beforeImg:"./assets/img/q1aBefore.png",afterImg:"./assets/img/q1aAfter.png",correct:!1},b:{beforeImg:"./assets/img/q1bBefore.png",afterImg:"./assets/img/q1bAfter.png",correct:!0}},{questionTextImg:"./assets/img/q2text.png",titleBackImg:"./assets/img/q2titleBack.png",questionNoImg:"./assets/img/q2No.png",a:{beforeImg:"./assets/img/q2aBefore.png",afterImg:"./assets/img/q2aAfter.png",correct:!0},b:{beforeImg:"./assets/img/q2bBefore.png",afterImg:"./assets/img/q2bAfter.png",correct:!1}},{questionTextImg:"./assets/img/q3text.png",titleBackImg:"./assets/img/q3titleBack.png",questionNoImg:"./assets/img/q3No.png",a:{beforeImg:"./assets/img/q3aBefore.png",afterImg:"./assets/img/q3aAfter.png",correct:!0},b:{beforeImg:"./assets/img/q3bBefore.png",afterImg:"./assets/img/q3bAfter.png",correct:!1}}];i.add(5,()=>I(0));i.add(10,()=>I(1));i.add(15,()=>I(2));i.add(18,()=>N());i.add(19,()=>S());let f=null;function L(){f||(f=new(window.AudioContext||window.webkitAudioContext),console.log("🎧 AudioContext initialized"))}async function P(){const n=["./assets/end.jpg",q,v,x,k,E,B,T];u.forEach(t=>{n.push(t.a.beforeImg,t.b.beforeImg,t.a.afterImg,t.b.afterImg,t.questionTextImg,t.questionNoImg,t.titleBackImg)});const e=["./assets/correct.mp3","./assets/wrong.mp3"];n.forEach(t=>{const r=new Image;r.src=t}),e.forEach(t=>{const r=new Audio(t);r.preload="auto"}),console.log("✅ すべてのアセットをプリロードしました")}window.addEventListener("load",()=>{P()});p.addEventListener("click",async()=>{L(),await f.resume(),b.classList.remove("start-screen"),p.style.display="none";try{h.src=v,i.reset(),await i.play(),g.loop=!0,g.currentTime=1.5,g.volume=.2,g.play()}catch(n){console.warn("Video playback blocked:",n)}m=0});function I(n){const e=u[n];i.pause(),d.src=e.titleBackImg,a.innerHTML=`
    <div class="quiz">
      <img id="questionNo" src="${e.questionNoImg}">
      <img id="questionText" src="${e.questionTextImg}">
      <div class="answers">
        <img class="ansA" src="${e.a.beforeImg}" onclick="selectAnswer('a')">
        <img class="ansB" src="${e.b.beforeImg}" onclick="selectAnswer('b')">
      </div>
    </div>
  `}window.selectAnswer=function(n){const e=u[m][n],t=e.correct;document.querySelectorAll(".answers img").forEach(y=>{y.style.pointerEvents="none",y.style.opacity="0.6"}),$(t?"correct.mp3":"wrong.mp3"),t||(d.src=k);const s=document.querySelector(`.ans${n.toUpperCase()}`),o=s.getBoundingClientRect(),l=s.parentElement.getBoundingClientRect(),c=document.createElement("img");c.src=e.afterImg,Object.assign(c.style,{position:"absolute",width:"35%",opacity:"1",transition:"opacity 0.3s ease-in-out",zIndex:7,pointerEvents:"none"}),c.style.left=`${o.left-l.left+o.width/2}px`,c.style.top=`${o.top-l.top+o.height/2}px`,c.style.transform="translate(-50%, -50%)",s.parentElement.appendChild(c),setTimeout(()=>{c.remove(),a.innerHTML="",m++,i.play()},2e3)};function N(){w.style.opacity="1"}function S(){w.style.opacity="0",a.innerHTML="",i.pause(),g.pause(),d.src=E,h.src=x;const n=document.createElement("img");n.src="",Object.assign(n.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",zIndex:"0"});const e=document.createElement("img");e.src=B,Object.assign(e.style,{position:"absolute",top:"45%",left:"50%",transform:"translate(-50%, -50%)",width:"40vw",zIndex:"2",pointerEvents:"none"});const t=document.createElement("img");t.src=T,Object.assign(t.style,{position:"absolute",top:"65%",left:"50%",transform:"translate(-50%, -50%)",width:"25vw",zIndex:"2",pointerEvents:"none"}),a.appendChild(n),a.appendChild(e),a.appendChild(t);const r=()=>{O(),a.removeEventListener("click",r),e.remove(),t.remove(),n.remove()};a.addEventListener("click",r)}function O(){i.pause(),i.reset(),a.innerHTML="",p.style.display="block",b.classList.add("start-screen"),m=0,d.src=u[0].titleBackImg,h.src=q}function $(n){const e=new Audio(`./assets/sound/${n}`);e.volume=.8,e.play()}
